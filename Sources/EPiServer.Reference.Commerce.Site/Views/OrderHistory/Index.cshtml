@using EPiServer.Commerce.Order
@using EPiServer.Reference.Commerce.Site.Features.Shared.Extensions
@using Mediachase.Commerce.Orders
@model EPiServer.Reference.Commerce.Site.Features.OrderHistory.ViewModels.OrderHistoryViewModel


<div class="container-fluid">
    <div class="row">
        @Html.Partial("_CmsNavigation", Model.CurrentPage)
        <div class="col-xs-12 col-sm-9">
            <div class="spacer-left-l">
                <div class="section-box">
                    <h2>@Html.PropertyFor(x => x.CurrentPage.Name)</h2>
                    @Html.PropertyFor(x => x.CurrentPage.MainBody)
                </div>

                @foreach (var order in Model.Orders)
                {
                    var orderForm = order.PurchaseOrder.GetFirstForm();

                    <div class="row section-box">
                        <div class="col-xs-12 col-sm-6">
                            <h3 class="h4">@Html.Translate("/OrderHistory/Labels/OrderID") @order.PurchaseOrder.OrderNumber</h3>
                            <p>
                                @Html.Translate("/OrderHistory/Labels/OrderDate") @order.PurchaseOrder.Created.ToLongDateString()<br>@Html.Translate("/OrderHistory/Labels/Status") <strong>@(order.QuoteStatus ?? order.PurchaseOrder.OrderStatus.ToString())</strong>
                                <br />
                                @Html.Translate("/OrderHistory/Labels/Payment")
                                @if (orderForm.Payments.Any())
                                {
                                    @String.Join(", ", orderForm.Payments.Select(x => x.PaymentMethodName))
                                }
                                <br>
                                @Html.Translate("/OrderHistory/Labels/TotalPrice") <strong>@order.PurchaseOrder.GetTotal().ToString()</strong>
                            </p>
                        </div>
                        <div class="col-xs-12 col-sm-6">
                            <h4>@Html.Translate("/OrderHistory/Labels/ShippedTo")</h4>

                            @foreach (var shippingAddress in order.ShippingAddresses)
                            {
                                @Html.Partial("_Address", shippingAddress)
                            }

                        </div>
                        <div class="col-xs-12 spacer-top-m">
                            <table class="table table-stripped no-border">
                                <thead>
                                    <tr>
                                        <th>
                                            Product
                                        </th>
                                        <th>
                                            Title
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in order.Items)
                                    {
                                        <tr>
                                            <td><a href="@item.LineItem.GetUrl()" class="link--black"><img src="@item.LineItem.GetThumbnailUrl()" /></a></td>
                                            <td><a href="@item.LineItem.GetUrl()" class="link--black">@item.LineItem.GetEntryContent().DisplayName</a></td>
                                        </tr>
                                    }

                                </tbody>
                            </table>
                        </div>

                    </div>
                    <hr />
                }
            </div>
        </div>
    </div>
</div>